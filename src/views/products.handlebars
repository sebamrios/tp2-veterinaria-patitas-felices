<link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet' />

<div class='container mt-4'>
	<h1>Stock de Productos</h1>

	<form id='product-form' class='row g-3 mb-4'>
		<input name='name' class='form-control' placeholder='Nombre' />
		<input name='price' type='number' step='0.01' class='form-control' placeholder='Precio' />
		<input name='quantity' type='number' class='form-control' placeholder='Cantidad' />
		<input name='category_id' type='number' class='form-control' placeholder='Categoría' />
		<button class='btn btn-primary'>Agregar</button>
	</form>

	<table class='table table-bordered'>
		<thead>
			<tr>
				<th>Nombre</th>
				<th>Precio</th>
				<th>Cantidad</th>
				<th>Categoría</th>
			</tr>
		</thead>
		<tbody>
			{{#each products}}
			<tr>
				<td>{{name}}</td>
				<td>{{price}}</td>
				<td>{{quantity}}</td>
				<td>{{category}}</td>
			</tr>
			{{/each}}
		</tbody>
	</table>
</div>

<script>
	const form = document.getElementById('product-form');
	form.addEventListener('submit', async (event) => {
		event.preventDefault(); //⛔ evita el redirect 
		const formData = new FormData(form); 
		const data = Object.fromEntries(formData.entries());
		const response = await fetch('/products/create', {
					method: 'POST', headers: {
						'Content-Type':
						'application/json'
					}, body: JSON.stringify(data)
				});
		if (response.ok) {
			alert('Producto agregado correctamente');
			// window.location.reload(); // simple, luego se puede mejorar
		} else {
			alert('Error al agregar producto');
		}
	});
</script>